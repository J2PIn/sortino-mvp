<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sortino — Import Agencies</title>
  <meta name="robots" content="noindex,nofollow" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: {
      fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
      boxShadow: { soft: "0 10px 30px rgba(15, 23, 42, 0.08)" }
    }}}
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="font-sans text-slate-900">
  <div class="fixed inset-0 -z-10">
    <div class="absolute inset-0 bg-[#fbfcff]"></div>
    <div class="absolute -top-32 left-1/2 h-[28rem] w-[52rem] -translate-x-1/2 rounded-full bg-cyan-200/40 blur-3xl"></div>
    <div class="absolute top-40 left-1/4 h-[26rem] w-[40rem] rounded-full bg-indigo-200/35 blur-3xl"></div>
    <div class="absolute top-[30rem] right-0 h-[26rem] w-[40rem] rounded-full bg-amber-200/25 blur-3xl"></div>
  </div>

  <main class="max-w-3xl mx-auto px-6 py-10">
    <header class="flex items-center justify-between">
      <a href="/" class="font-semibold">Sortino</a>
      <a href="/admin.html" class="text-sm underline">Admin</a>
    </header>

    <h1 class="mt-8 text-3xl font-semibold tracking-tight">Import agencies (CSV → D1)</h1>
    <p class="mt-3 text-slate-700">
      Upload a CSV to seed the directory. Listings are saved as <span class="font-semibold">Unverified</span>.
    </p>

    <section class="mt-6 rounded-3xl bg-white/80 backdrop-blur ring-1 ring-slate-200 shadow-soft p-6">
      <label class="text-xs font-semibold text-slate-700">ADMIN_TOKEN</label>
      <input id="token" type="password" class="mt-1 w-full rounded-2xl ring-1 ring-slate-200 px-4 py-3 text-sm" placeholder="Paste token…" />

      <div class="mt-4">
        <label class="text-xs font-semibold text-slate-700">CSV file</label>
        <input id="file" type="file" accept=".csv,text/csv" class="mt-1 w-full text-sm" />
      </div>

      <button id="upload"
        class="mt-5 rounded-xl bg-slate-900 text-white px-4 py-3 text-sm font-semibold hover:bg-slate-800">
        Upload & import
      </button>

      <pre id="out" class="mt-4 hidden rounded-2xl bg-slate-50 ring-1 ring-slate-200 p-4 text-xs overflow-auto"></pre>

      <div class="mt-5 text-xs text-slate-600">
        Required headers: <span class="font-mono">name, website</span> (others optional: location, primary_service, services, industries, source)
      </div>
    </section>
  </main>

  <script>
    const btn = document.getElementById("upload");
    const out = document.getElementById("out");

    btn.addEventListener("click", async () => {
      const token = document.getElementById("token").value.trim();
      const file = document.getElementById("file").files[0];

      if (!token) return alert("Missing ADMIN_TOKEN");
      if (!file) return alert("Pick a CSV file");

      btn.disabled = true;
      btn.textContent = "Importing…";

      try {
        const fd = new FormData();
        fd.append("file", file);

        const res = await fetch("/api/admin/import-agencies", {
          method: "POST",
          headers: { "Authorization": `Bearer ${token}` },
          body: fd
        });

        const text = await res.text();
        out.classList.remove("hidden");
        out.textContent = text;

        if (!res.ok) alert("Import failed. Check output.");
      } catch (e) {
        out.classList.remove("hidden");
        out.textContent = String(e);
        alert("Import error.");
      } finally {
        btn.disabled = false;
        btn.textContent = "Upload & import";
      }
    });
  </script>
</body>
</html>
